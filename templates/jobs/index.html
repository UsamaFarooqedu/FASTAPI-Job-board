{% extends "base.html" %}

{% block title %}Find Jobs - JobHub{% endblock %}

{% block content %}
<div class="container">
    <div style="margin-bottom: 2rem; text-align: center;">
        <h1>Find Your Next Opportunity</h1>
        <p style="color: var(--text-muted);">Search thousands of jobs from top companies</p>
    </div>

    <div class="dashboard-grid">
        <aside>
            <div class="card">
                <h3 style="margin-bottom: 1rem;">Filters</h3>
                <form id="filterForm">
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; font-size: 0.875rem; margin-bottom: 0.5rem;">Keywords</label>
                        <input type="text" id="keyword" placeholder="Design, Engineering..."
                            style="width: 100%; padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 0.25rem;">
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; font-size: 0.875rem; margin-bottom: 0.5rem;">Job Type</label>
                        <select id="jobType"
                            style="width: 100%; padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 0.25rem;">
                            <option value="">All Types</option>
                            <option value="Full-time">Full-time</option>
                            <option value="Part-time">Part-time</option>
                            <option value="Contract">Contract</option>
                            <option value="Internship">Internship</option>
                            <option value="Remote">Remote</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; font-size: 0.875rem; margin-bottom: 0.5rem;">Experience</label>
                        <select id="experience"
                            style="width: 100%; padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 0.25rem;">
                            <option value="">Any Level</option>
                            <option value="Entry">Entry</option>
                            <option value="Mid">Mid</option>
                            <option value="Senior">Senior</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Apply Filters</button>
                    <button type="reset" id="resetBtn"
                        style="width: 100%; margin-top: 0.5rem; background: none; border: none; color: var(--primary); cursor: pointer;">Clear
                        All</button>
                </form>
            </div>
        </aside>

        <section>
            <div id="jobsList" style="display: flex; flex-direction: column; gap: 1rem;">
                <p>Loading jobs...</p>
            </div>
        </section>
    </div>
</div>

<script>
    async function loadJobs() {
        const keyword = document.getElementById('keyword').value;
        const jobType = document.getElementById('jobType').value;
        const experience = document.getElementById('experience').value;

        let url = `/api/jobs/?q=${encodeURIComponent(keyword)}`;
        if (jobType) url += `&job_type=${jobType}`;
        if (experience) url += `&experience=${experience}`;

        const response = await fetch(url);
        const jobs = await response.json();

        const container = document.getElementById('jobsList');
        if (jobs.length === 0) {
            container.innerHTML = '<div class="card" style="text-align: center; padding: 3rem;">No jobs found. Try adjusting your filters.</div>';
            return;
        }

        container.innerHTML = jobs.map(job => `
        <div class="card" style="cursor: pointer;" onclick="viewJob(${job.id})">
            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div>
                    <h3 style="color: var(--primary);">${job.title}</h3>
                    <p style="font-weight: 600;">${job.company.company_name} â€¢ ${job.location || 'Remote'}</p>
                    <p style="font-size: 0.875rem; color: var(--text-muted); margin-top: 0.5rem;">${job.description.substring(0, 150)}...</p>
                </div>
                <div style="text-align: right;">
                    <span style="background: #e0e7ff; color: #4338ca; padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.75rem; font-weight: 600;">${job.employment_type}</span>
                    <p style="margin-top: 0.5rem; font-weight: 700;">${job.currency} ${job.salary_min.toLocaleString()} - ${job.salary_max.toLocaleString()}</p>
                </div>
            </div>
        </div>
    `).join('');
    }

    function viewJob(id) {
        window.location.href = `/jobs/${id}`;
    }

    document.getElementById('filterForm').onsubmit = (e) => {
        e.preventDefault();
        loadJobs();
    };

    document.getElementById('resetBtn').onclick = () => {
        setTimeout(loadJobs, 0);
    };

    loadJobs();
</script>
{% endblock %}