{% extends "base.html" %}

{% block title %}Manage Jobs - JobHub{% endblock %}

{% block content %}
<div class="container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h1>Your Job Postings</h1>
        <a href="/company/post-job" class="btn btn-primary">+ Post New Job</a>
    </div>

    <div id="companyJobsList" style="display: flex; flex-direction: column; gap: 1rem;">
        <p>Loading your listings...</p>
    </div>
</div>

<script>
    async function loadCompanyJobs() {
        const token = localStorage.getItem('token');
        // In a real app, you'd have an endpoint specifically for company's own jobs
        // For this dev version, we'll filter or show how to handle authorization
        const resp = await fetch('/api/jobs/', {
            headers: { 'Authorization': `Bearer ${token}` }
        });
        const jobs = await resp.json();

        const container = document.getElementById('companyJobsList');
        container.innerHTML = jobs.map(job => `
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h3>${job.title}</h3>
                    <p style="color: var(--text-muted);">${job.department} â€¢ ${job.employment_type}</p>
                    <p style="font-size: 0.875rem; margin-top: 0.5rem;">
                        <strong>Status:</strong> ${job.is_active ? '<span style="color: var(--success);">Active</span>' : '<span style="color: var(--error);">Closed</span>'} | 
                        <strong>Applicants:</strong> ${job.applications?.length || 0}
                    </p>
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    <button class="btn" style="background: #f1f5f9;" onclick="viewApplicants(${job.id})">View Applicants</button>
                    <button class="btn" style="background: #fee2e2; color: #b91c1c;">Close</button>
                </div>
            </div>
        </div>
    `).join('');
    }

    function viewApplicants(id) {
        // Navigate to applicant management for this job
        alert('Viewing applicants for job ' + id);
    }

    loadCompanyJobs();
</script>
{% endblock %}